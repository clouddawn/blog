# JavaScript 运行原理

## JS 是一门什么样的语言？

* **JavaScript 是一门高级的编程语言**

* 从编程语言发展历史来说，可以划分为三个阶段：

  * 机器语言：1000100111011000，一些机器指令；
  * 汇编语言：mov、ax、bx、一些汇编指令;
  * 高级语言：C、C++、Java、JavaScript、Python；

* 但是计算机本身是不认识这些高级语言的，所以我们的代码最终还是需要被转换成机器指令：

  ![image](../images6/213/01.png)

## 浏览器的工作原理

* JavaScript 代码，在浏览器中是如何被执行的？

  ![image](../images6/213/02.png)

## 认识浏览器的内核

#### 不同的浏览器由不同的内核组成 

* **Gecko**：早期被Netscape和Mozilla Firefox浏览器浏览器使用； 

* **Trident**：微软开发，被IE4~IE11浏览器使用，但是Edge浏览器已经转向Blink； 

* **Webkit**：苹果基于KHTML开发、开源的，用于Safari，Google Chrome之前也在使用； 

* **Blink**：是Webkit的一个分支，Google开发，目前应用于Google Chrome、Edge、Opera等； 

* 等等... 

#### 事实上，我们经常说的浏览器内核指的是浏览器的排版引擎： 

* **排版引擎**（layout engine），也称为**浏览器引擎**（browser engine）、**页面渲染引擎**（rendering engine）或**样版引擎**。

## 浏览器渲染过程

![image](../images6/213/03.png)

#### JavaScript 代码由谁来执行呢？

* JavaScript 引擎

## 认识 JavaScript 引擎

* #### 为什么需要JavaScript引擎呢？
  * 前面说过，高级的编程语言都是需要转成最终的机器指令来执行的； 
  * 事实上我们编写的JavaScript无论你交给浏览器或者Node执行，最后都是需要被CPU执行的； 
  * 但是CPU只认识自己的指令集，实际上是机器语言，才能被CPU所执行； 

  * 所以我们需要JavaScript引擎帮助我们将JavaScript代码翻译成CPU指令来执行； 

* #### 比较常见的JavaScript引擎有哪些呢？
  * **SpiderMonkey**：第一款JavaScript引擎，由Brendan Eich开发（也就是JavaScript作者）； 
  * **Chakra**：微软开发，用于IE浏览器； 
  * **JavaScriptCore**：WebKit中的JavaScript引擎，Apple公司开发； 
  * **V8**：Google开发的强大JavaScript引擎，也帮助Chrome从众多浏览器中脱颖而出； 
  * 等等…

## 浏览器内核和JS引擎的关系

这里我们先以 WebKit 为例，WebKit 事实上由两部分组成的： 

* **WebCore：**负责HTML解析、布局、渲染等等相关的工作； 

* **JavaScriptCore：**解析、执行 JavaScript 代码； 

![image](../images6/213/04.png)

* 在小程序中编写的 JavaScript 代码就是被 JSCore 执行的；

![image](../images6/213/05.png)































